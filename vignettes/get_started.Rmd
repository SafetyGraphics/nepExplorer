---
title: "Getting Started with nepExplorer"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with nepExplorer}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Installation
```{r eval=FALSE}
devtools::install_github("safetyGraphics/nepExplorer", ref = "main")
```

# Setup
```{r}
library(nepExplorer)
```

# Standalone App

## Data Mapping
A comprehensive mapping helps nepExplorer correctly interpret your clinical trial datasets. To ensure your data is compatible with nepExplorer and you can effectively utilize its features, please see the following link for detailed information about required data domains, data format, and specific column requirements: [Data and Settings Guidelines](https://github.com/SafetyGraphics/nepExplorer/wiki/2.-Data-and-Settings-Guidelines#required-data-domains). This resource provides a comprehensive guide to preparing your data for analysis and visualization within nepExplorer.


```{r}
custom_map <- list(
  vitals = list(
    "id_col" = "USUBJID",          # Unique subject identifier
    "treatment_col" = "ARM",        # Treatment arm
    "measure_col" = "TEST",         # Vitals measure variable
    "value_col" = "VSSTRESN",      # Vitals result value
    "unit_col" = "VSSTRESU",       # Unit of measure
    "visit_col" = "VISIT",         # Visit name
    "visitn_col" = "VISITNUM",     # Visit number
    "studyday_col" = "VSDY",       # Study day
    "vs_baseline_flag" = "ABLFL",  # Baseline flag column
    "vs_baseline_values" = "Y", # Baseline value
    "measure_values" = list(
      "SYSBP" = "Systolic Blood Pressure (mmHg)",
      "DIABP" = "Diastolic Blood Pressure (mmHg)"
    )
  ),
  labs = list(
    "id_col" = "USUBJID",
    "treatment_col" = "ARM",
    "measure_col" = "LBTEST",
    "value_col" = "LBSTRESN",
    "unit_col" = "LBSTRESU",
    "studyday_col" = "LBDY",
    "visit_col" = "VISIT",
    "visitn_col" = "VISITNUM",
    "baseline_flag" = "LBBLFL",
    "baseline_values" = list("Y" = "Y"),
    "measure_values" = list(
      "ALB" = "Albumin (mg/dL)",
      "ALB/CREAT" = "Albumin/Creatinine",
      "BICARB" = "Bicarbonate (umol/L)",
      "BUN" = "Blood Urea Nitrogen (mmol/L)",
      "BUN/CREAT" = "Blood Urea Nitrogen/Creatinine",
      "CA" = "Calcium (mmol/L)",
      "CL" = "Chloride (mmol/L)",
      "CREAT" = "Creatinine (mg/dL)",
      "CYSTC" = "Cystatin C (umol/L)",
      "eGFR" = "eGFR (mL/min)",
      "eGFRcys" = "eGFRcys (mL/min)",
      "PHOS" = "Phosphate (mmol/L)",
      "K" = "Potassium (mmol/L)",
      "SODIUM" = "Sodium (mmol/L)"
    )
  ),
  dm = list(
    "id_col" = "USUBJID",
    "treatment_col" = "ARM"
  )
)
```

## Launch App
```{r eval=FALSE}
create_nepexplorer_app(
  data = list(
    dm = nepExplorer::adsl,        # Demographic data
    labs = nepExplorer::adlb,      # Laboratory measurements
    vitals = nepExplorer::advs     # Vital signs
  ),
  mapping = custom_map
)
```

## Configuration Guide

### Required Fields
- `id_col`: Unique subject identifier
- `measure_col`: Measurement type column
- `value_col`: Numeric result column
- `unit_col`: Measurement units
- `visit_col`: Visit name
- `visitn_col`: Visit number
- `studyday_col`: Study day
- `baseline_flag`: Baseline identification column
- `baseline_values`: Value in `baseline_flag` column indicating a baseline record

### Required Lab Test
- `Creatinine`: Creatinine is a required lab test collected in `measure_col`. It must be in conventional units. 

### Best Practices
- Match column names exactly to your dataset
- Modify `measure_values` to match your specific measurements
- Ensure consistent column naming across datasets

### Common Issues
- Verify data frame column names
- Check data types and formats
- Ensure all required columns are present
- Ensure lab results are in conventional units

## safetyGraphics application

This nepExplorer charts can be added to the {safetyGraphics} shiny app, which allows us to create the charts with any mappings/data combination loaded in the app. The configuration will be captured in a [YAML](https://yaml.org/) file.

```yaml
env: safetyGraphics
label: Nep Explorer - Module
name: nepexplorerMod
type: module
package: nepExplorer
order: 9
domain:
  - labs
- vitals
- dm
workflow:
  ui: nepexplorer_ui
server: nepexplorer_server
links:
  nepExplorer: https://github.com/SafetyGraphics/nep-explorer
```

With the nepExplorer loaded in to our session and the configuration file saved in our working directory as nepExplorer.yaml, we can add the charts to the app as follows:


```{r eval=FALSE}
library(nepExplorer)

library(yaml)

charts <- c(
  safetyGraphics::makeChartConfig(),
  safetyGraphics::makeChartConfig(
    packages = "nepExplorer",
    packageLocation = "./inst/config", # location of nepExplorer.yaml file
    sourceFiles = TRUE
  )
)
charts$nepexplorerMod$meta <- nepExplorer::meta_nepExplorer

safetyGraphics::safetyGraphicsApp(
  domainData = list(
    labs = safetyData::adam_adlbc,
    dm = safetyData::adam_adsl,
    vitals = safetyData::adam_advs
  ),
  charts = charts
)
```


Under the charts tab, you'll see:

-TBD: mention update to mapping for this example
-TBD: mention the chat
-TBD: mention what to lookout for
